<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/voxpelli/node-connect-pg-simple#readme"

    >connect-pg-simple (v3.1.2)</a>
</h1>
<h4>A simple, minimal PostgreSQL session store for Connect/Express</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.connect-pg-simple">module connect-pg-simple</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.connect-pg-simple.connect-pg-simple">
            function <span class="apidocSignatureSpan"></span>connect-pg-simple
            <span class="apidocSignatureSpan">(session)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.connect-pg-simple" id="apidoc.module.connect-pg-simple">module connect-pg-simple</a></h1>


    <h2>
        <a href="#apidoc.element.connect-pg-simple.connect-pg-simple" id="apidoc.element.connect-pg-simple.connect-pg-simple">
        function <span class="apidocSignatureSpan"></span>connect-pg-simple
        <span class="apidocSignatureSpan">(session)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect-pg-simple = function (session) {

  var Store = session.Store || session.session.Store,
    PGStore;

  PGStore = function (options) {
    options = options || {};
    Store.call(this, options);

    this.schemaName = options.schemaName || null;
    this.tableName = options.tableName || &#x27;session&#x27;;

    this.conString = options.conString || process.env.DATABASE_URL;
    this.ttl =  options.ttl;
    this.pg = options.pg || require(&#x27;pg&#x27;);
    this.ownsPg = !options.pg;

    this.errorLog = options.errorLog || console.error.bind(console);

    if (options.pruneSessionInterval === false) {
      this.pruneSessionInterval = false;
    } else {
      this.pruneSessionInterval = (options.pruneSessionInterval || 60) * 1000;
      setImmediate(function () {
        this.pruneSessions();
      }.bind(this));
    }
  };

<span class="apidocCodeCommentSpan">  /**
   * Inherit from `Store`.
   */
</span>
  util.inherits(PGStore, Store);

  /**
   * Closes the session store
   *
   * Currently only stops the automatic pruning, if any, from continuing
   *
   * @access public
   */

  PGStore.prototype.close = function () {
    this.closed = true;

    if (this.pruneTimer) {
      clearTimeout(this.pruneTimer);
      this.pruneTimer = undefined;
    }

    if (this.ownsPg) {
      this.pg.end();
    }
  };

  /**
   * Does garbage collection for expired session in the database
   *
   * @param {Function} [fn] - standard Node.js callback called on completion
   * @access public
   */

  PGStore.prototype.pruneSessions = function (fn) {
    this.query(&#x27;DELETE FROM &#x27; + this.quotedTable() + &#x27; WHERE expire &#x3c; to_timestamp($1)&#x27;, [currentTimestamp()], function (err) {
      if (fn &#x26;&#x26; typeof fn === &#x27;function&#x27;) {
        return fn(err);
      }

      if (err) {
        this.errorLog(&#x27;Failed to prune sessions:&#x27;, err.message);
      }

      if (this.pruneSessionInterval &#x26;&#x26; !this.closed) {
        if (this.pruneTimer) {
          clearTimeout(this.pruneTimer);
        }
        this.pruneTimer = setTimeout(this.pruneSessions.bind(this, true), this.pruneSessionInterval);
      }
    }.bind(this));
  };

  /**
   * Get the quoted table.
   *
   * @return {String} the quoted schema + table for use in queries
   * @access private
   */

  PGStore.prototype.quotedTable = function () {
    var result = &#x27;&#x22;&#x27; + this.tableName + &#x27;&#x22;&#x27;;

    if (this.schemaName) {
      result = &#x27;&#x22;&#x27; + this.schemaName + &#x27;&#x22;.&#x27; + result;
    }

    return result;
  };

  /**
   * Figure out when a session should expire
   *
   * @param {Number} [maxAge] - the maximum age of the session cookie
   * @return {Number} the unix timestamp, in seconds
   * @access private
   */

  PGStore.prototype.getExpireTime = function (maxAge) {
    var ttl = this.ttl;

    ttl = ttl || (typeof maxAge === &#x27;number&#x27; ? maxAge / 1000 : oneDay);
    ttl = Math.ceil(ttl + currentTimestamp());

    return ttl;
  };

  /**
   * Query the database.
   *
   * @param {String} query - the database query to perform
   * @param {(Array|Function)} [params] - the parameters of the query or the callback function
   * @param {Function} [fn] - standard Node.js callback returning the resulting rows
   * @access private
   */

  PGStore.prototype.query = function (query, params, fn) {
    if (!fn &#x26;&#x26; typeof params === &#x27;function&#x27;) {
      fn = params;
      params = [];
    }
    this.pg.connect(this.conString, function (err, client, done) {
      if (err) {
        done(client);
        if (fn) { fn(err); }
      } else {
        client.query(query, params || [], function (err, result) {
          done(err || false);
          if (fn) { fn(err, result &#x26;&#x26; result.rows[0] ? result.rows[0] : false); }
        });
      }
    });
  };

  /**
   * Attempt to fetch session by the given `sid`.
   *
   * @param {String} sid – the session id
   * @param {Function} fn – a standard Node.js callback returning the parsed session object
   * @access public
   */

  PGStore.prototype.get = function (sid, fn) {
    this.query(&#x27;SELECT sess FROM &#x27; + this.quotedTable() + &#x27; WHERE sid = $1 AND expire &#x3e;= to_timestamp($2)&#x27;, [sid, currentTimestamp
()], function (err, data) {
      if (err) { return ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
